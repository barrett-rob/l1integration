<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/mx" 
			   minWidth="1024" 
			   minHeight="768"
			   creationComplete="creationComplete(event)">
	<fx:Declarations>
	</fx:Declarations>
	<fx:Script>
		<![CDATA[
			import mfui.widgets.linkone.Tile;
			import mfui.widgets.linkone.TileImage;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Image;
			import mx.controls.VScrollBar;
			import mx.core.UIComponent;
			import mx.events.FlexEvent;
			
			import spark.components.BorderContainer;
			
			[Bindable]
			public var uris:ArrayCollection = new ArrayCollection(
				[
					{uri:'book=komatsu/D355A-3&page=343A&pictureidentity=1_1'}, 
					{uri:'book=komatsu/D355A-3&page=222A&pictureidentity=1_1_2_3'}
				]                
			);
			
			var zoom_depth:int = 4;
			
			protected function creationComplete(event:FlexEvent):void
			{
				levelInput.text = '10';
				uriDropdown.selectedIndex = 0;
			}
			
			
			protected function go(event:Event):void
			{
				var i:int, j:int, k:int, w:int, h:int;
				for (i = 0; i < images.numChildren; i++)
				{
					var c:DisplayObject = images.getChildAt(i);
					if (c is Image)
					{
						Image(c).source = null;
					}
					images.removeChild(c);
				}

				Tile.tile_level_offset = int(levelInput.text);
				var y_offset:int = 0;
				
				for (i = 0; i < zoom_depth; i++)
				{
					y_offset = i * Tile.virtual_height;
					w = Tile.virtual_width / (i + 1);
					h = Tile.virtual_height / (i + 1);
					for (j = 0; j <= i; j++)
					{
						for (k = 0; k <= i; k++)
						{
							var t:Tile = new Tile(w, h, uris[uriDropdown.selectedIndex].uri, i, j, k);
							t.left = j * w;
							t.top = y_offset + (k * h);
							images.addChild(t);
						}
					}
				}
				images.validateNow();
			}
			
			
		]]>
	</fx:Script>
	
	<s:VGroup
		height="100%"
		width="100%"
		>
		
		<s:HGroup
			width="100%"
			>
			<mx:Label
				text="Uri:" />
			<s:DropDownList
				id="uriDropdown"
				dataProvider="{uris}"
				labelField="uri"
				width="33%"
				/>
			<mx:Label
				text="Level:" />
			<mx:TextInput
				id="levelInput"
				width="5%" />
			<mx:Button
				label="Go"
				click="go(event)" />
		</s:HGroup>
		
		<mx:Panel
			id="images"
			title="Image Pyramid"
			height="100%"
			width="100%"
			layout="absolute"
			verticalScrollPolicy="auto"
			>
		</mx:Panel>
	</s:VGroup>
	
	
</s:Application>
